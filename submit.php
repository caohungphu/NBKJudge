<?php //Code by Hung Phu - Update: 7/10/2019	include_once("includes/header.php"); 	include_once("includes/config.php"); 	if(!isset($_GET["NBKJudge"])){$_GET["NBKJudge"]='';}	if (isset($_SESSION['user_id'])){	//Check submit		date_default_timezone_set("Asia/Bangkok"); 		$hp_sql_query_1 = "SELECT * FROM caidat WHERE id='1'";		$hp_get_setting = $db_connect->query($hp_sql_query_1); 		$hp_setting = $hp_get_setting->fetch_assoc();		$hp_allow_submit = "{$hp_setting['submission']}";		$user_id = intval($_SESSION['user_id']);		$hp_sql_query_1 = "SELECT * FROM members WHERE id='{$user_id}'"; 		$hp_get_member = $db_connect->query($hp_sql_query_1); 		$hp_member = $hp_get_member->fetch_assoc();		$hp_table = "{$hp_setting['cosodulieu']}";		$hp_sql_query_3 = "SELECT * FROM data WHERE tentable='{$hp_table}'"; 		$hp_get_data = $db_connect->query($hp_sql_query_3); 		$hp_data = $hp_get_data->fetch_assoc();		$timestart = $hp_data['timestart'];		$timefinish = $hp_data['timefinish'];		$timefinishstr = strtotime($hp_data['timefinish']);			$datetimenowstr = strtotime(date('Y-m-d h:i:s', time()));			$hp_sub = intval(($timefinishstr - $datetimenowstr));				//Tat submit		if ($hp_member['admin'] == "0"){			if ($hp_allow_submit == 0) {				print "<script>Swal.fire( 'Admin đã tắt nộp bài!', 'Hệ thống đang chuyển hướng về trang chủ', 'error' );</script>";				include_once("includes/footer.php");				print "<meta http-equiv='refresh' content='0; ./'>";				exit;			}			if ($hp_data['timecount'] == 1){				if ($hp_sub<=0){					print "<script>Swal.fire( 'Đã hết thời gian nộp bài', 'Hệ thống đang chuyển hướng về trang chủ', 'error' );</script>";					include_once("includes/footer.php");					print "<meta http-equiv='refresh' content='0; ./'>";					exit;				}			}		}		//Thoi gian		if (isset($_GET['action']) && $_GET['action'] == "submit" ){			$tenfile = basename($_FILES["fileToUpload"]["name"]);			$tenfile = str_replace('.','].',$tenfile);			$namefile = "[{$hp_member['username']}][" . $tenfile;			$target_file = $hp_dir_submit . $namefile;			$uploadOk = 1;			//Check file			$hp_language = strtoupper(pathinfo($target_file,PATHINFO_EXTENSION));			if ($_FILES["fileToUpload"]["size"] > 500000) {				$uploadOk = 0;			}			if ($hp_language != "PAS" && $hp_language != "PP" && $hp_language != "CPP"				&& $hp_language != "JAVA" && $hp_language != "C") {					$uploadOk = 0;			}			//Check upload			$hp_name_bai_done = basename( $_FILES["fileToUpload"]["name"]);			if ($uploadOk == 0){				include_once("includes/header.php");				print "<script>Swal.fire( 'Nộp bài {$hp_name_bai_done} thất bại!', 'Hệ thống đang chuyển hướng về trang nộp bài', 'error' );</script>";				include_once("includes/footer.php");				echo "<font color=red><b></b></font><br>";				print "<meta http-equiv='refresh' content='0; /?NBKJudge=submit'>";			} else {				if (move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $target_file)) {					include_once("includes/header.php");					print "<script>Swal.fire( 'Nộp bài {$hp_name_bai_done} thành công!', 'Hệ thống đang chuyển hướng về bảng xếp hạng', 'success' );</script>";					include_once("includes/footer.php");					print "<meta http-equiv='refresh' content='0; ./?NBKJudge=rank'>";				} else {					include_once("includes/header.php");					print "<script>Swal.fire( 'Lỗi trong quá trình tải lên', 'Hệ thống đang chuyển hướng về trang nộp bài', 'error' );</script>";					include_once("includes/footer.php");					echo "<font color=red><b></b></font><br>";					print "<meta http-equiv='refresh' content='0; /?NBKJudge=submit'>";				}			}				} else {print <<<EOF<section class="forms">    <div class="container-fluid">        <!-- Page Header-->        <header>             <h1 class="h3 display">NỘP BÀI</h1>        </header>        <div class="row">				<div class="col-lg-12">					<div class="card">							<div class="card-header">							<h4><center> Nộp bài NBK Judge </center></h4> 						</div>						<div class="card-body">							<form action="submit.php?action=submit" method="post" enctype="multipart/form-data">								<div class="form-group">									<label><b>Chọn bài làm:</b></label>									<input class="form-control" type="file" name="fileToUpload" id="fileToUpload">								</div>								<label><font color="red">(*) Lưu ý: - Tên file phải giống tên đề bài</font></label><br>								<label>									<font color="red">										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;										- Dung lượng file không quá 2MB									</font>								</label><br>								<label>									<font color="red">										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;										- Định dạng hợp lệ: *.pas, *.pp, *.cpp, *.java, *.c									</font>								</label>								<div class="form-group">       									<center><input type="submit" name="submit" value="Nộp bài" class="btn btn-primary"></center>								</div>							</form>						</div>     					</div>				</div>		</div>		    </div></section>EOF;}			} else {	include_once("includes/header.php");	print "<script>Swal.fire('Chưa đăng nhập!', 'Hệ thống đang chuyển hướng về trang chủ', 'error' );</script>";	include_once("includes/footer.php");	print "<meta http-equiv='refresh' content='0; ./'>";}?><?php include_once("includes/footer.php"); ?>